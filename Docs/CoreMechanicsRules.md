# 《声骸》核心玩法规则细化

## 1. 基础属性

### 1.1 玩家
- **生命状态**：`存活` / `死亡`，为所有交互与事件的前置判断。
- **移动速度**：基准移动速度值，可被状态效果（如强制闭眼、瘫痪器使用动画）临时修改。
- **眼睛湿润度**：0-100 的资源槽，表示维持睁眼的能力；支持最小/最大值钳制以及恢复与消耗速率的可调节参数。

### 1.2 怪物
- **怪物状态**：`移动中` / `静止`。
- **凝视检测权重**：用于判定怪物与玩家视线的关系，包含视线是否遮挡、距离阈值等。

### 1.3 NPC
- **NPC 状态**：`正常` / `死亡凝视` / `死亡`。
- **死亡动画引用**：虽然暂缺成品动画，但需要指定资源槽位，以便将来替换。

### 1.4 瘫痪器
- **瘫痪器状态**：`已损坏` → `已修复` → `已充能`。
- **效果半径**：应用于怪物的冻结距离。

## 2. 游戏规则

### 2.1 凝视与追逐相关
1. **追逐规则**：怪物状态为`移动中`时，以当前速度沿路径持续逼近玩家目标。
2. **凝视规则**：
   - 只要怪物的任意碰撞体在玩家摄像机视锥内且无遮挡，怪物状态立刻切换为`静止`。
   - 失去视线（离开视锥或被遮挡）后，怪物延迟 0 秒直接恢复为`移动中`。
3. **威胁规则**：
   - 怪物处于`移动中`且与玩家发生碰撞时，玩家生命状态切换为`死亡`。
   - 切换时触发玩家死亡事件（供音效、UI、关卡逻辑订阅）。

### 2.2 眨眼机制相关
1. **干涩规则**：睁眼期间湿润度每秒减少基础值 `dryRate`。
2. **湿润规则**：手动闭眼时按 `wetRate`/秒恢复湿润度。
3. **惩罚规则**：湿润度降至 0 时进入“强制闭眼”状态：
   - 强制闭眼持续 `forcedDuration` 秒，期间玩家视野遮罩全黑、移动被禁用。
   - 状态结束后湿润度回到 `forcedRecovery`（如 30%）并允许玩家重新控制睁闭眼。

### 2.3 解谜与瘫痪器
1. **修复规则**：收集到指定数量的修复碎片并在合成台互动后，瘫痪器状态改为`已修复`。
2. **充能规则**：处于`已修复`状态时，通过专用交互（如手摇条、连续按键）积累进度至 100%，状态改为`已充能`。
3. **使用规则**：
   - 在`已充能`状态下激活瘫痪器，对范围内怪物施加“回到出生点并冻结 N 秒”的效果。
   - 使用后状态回落为`已损坏`，流程重置。

## 3. 新增细化内容

### 3.1 怪物逼近触发玩家呼吸声
- **触发条件**：以玩家为中心的同心圆分为三段：
  - `警觉距离`（例如 15 米）：开始播放浅呼吸音量（占最大音量的 30%）。
  - `紧张距离`（例如 8 米）：音量提升至 60%，并可叠加心率加快的副音轨。
  - `恐慌距离`（例如 3 米）：音量 100%，呼吸节奏加快。
- **渐变逻辑**：音量按距离线性或曲线插值渐变，避免突兀跳变。
- **资源占位**：当前无最终音频，需预留 `AudioSource` 槽位及播放接口，使用占位音（如 Debug beep）验证流程。
- **状态联动**：
  - 玩家死亡、强制闭眼时立即淡出呼吸声。
  - 瘫痪器影响导致怪物瞬移离开时，按新距离重新计算音量。

### 3.2 怪物接近 NPC 的死亡演出
- **触发条件**：当怪物距离任意 NPC 的中心点小于 `npcKillDistance`（建议 2 米）且怪物处于`移动中`时。
- **状态变化**：
  - NPC 状态由当前状态转为`死亡`，不再响应世界异常或巡逻逻辑。
  - NPC 的 Animator 播放死亡动画剪辑；若尚无动画，使用占位过渡至“死亡姿态”并保持最后一帧。
- **动画冻结**：死亡动画播放完毕后，将 Animator 切换为 `Animator.speed = 0` 并定位到最后帧，实现尸体保持。
- **音效接口**：
  - 触发时调用预留的音效播放接口（如 `PlayNpcDeathSfx()`）。
  - 目前可绑定占位音源，待正式素材更新后替换。
- **世界影响**：
  - 死亡 NPC 不再参与凝视演出，也不会被瘫痪器复活。
  - 如 NPC 是剧情关键，可在状态切换时通知剧情系统。

### 3.3 系统交互补充
- **事件广播**：
  - 玩家呼吸音、NPC 死亡均通过事件或脚本化对象广播，供音频、UI、任务系统监听。
- **调试工具**：
  - 提供可视化调试（Gizmos）展示各类距离阈值，便于关卡内调校。
  - Inspector 暴露所有阈值、音量曲线及动画持续时间参数。

### 3.4 合成台 Prefab 配置
- **脚本绑定**：在合成台物体上挂载 `CraftingStation` 组件，并在 Inspector 中设置以下引用：
  - `Crafting Ui`：指向场景或合成台子节点上的 `CraftingUI` 组件（包含 Slider + Canvas）。
  - `Repaired Disabler Mount`：合成台上用于生成修复后瘫痪器的空物体。脚本将在此位置生成 Prefab 并设为其子节点，保证朝向一致。
- **Prefab 引用**：在 `Repaired Disabler Prefab` 字段放入修复后瘫痪器的预制体实例。
- **场景验证**：确保玩家角色的 `PlayerInteractionController` 已配置 `DisablerDevice` 引用，否则合成条件无法满足。
- **UI 生命周期**：`CraftingStation` 会在开始合成时调用 `PlayerInteractionController.IsUiOpen = true`。确认 UI 隐藏动画结束时会回调 `Hide()`，避免玩家在 UI 仍显示时重新获得交互输入。

## 4. 数据与平衡建议
- 初始建议数值：
  - `dryRate`：每秒 8 单位；`wetRate`：每秒 20 单位；`forcedDuration`：3 秒。
  - 玩家呼吸阈值：`警觉`15 m / `紧张`8 m / `恐慌`3 m（可按关卡尺寸调整）。
  - 瘫痪器冻结效果：回到出生点并静止 6 秒。
- 所有数值应在表格配置或 ScriptableObject 中维护，允许随版本迭代快速调整。

## 5. 资源占位说明
- **音效**：
  - 玩家呼吸声、NPC 死亡声使用占位剪辑，需在音频资源到位后统一替换。
  - 预留淡入淡出时间（0.25-0.5 秒）以避免硬切。
- **动画**：
  - NPC 死亡动画可使用临时姿态或简单骨骼过渡；最终动画导入后需验证最后帧冻结效果。

通过以上细化规则，可在不影响既有 Prefab 控制器的前提下，为编程、音频、动画团队提供明确的实现和验收标准。
